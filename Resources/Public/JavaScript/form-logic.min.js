function d(t){return[].slice.call(t)}function E(t){return t.length>0?t[0].toUpperCase()+t.substr(1):""}function v(t){return t.length>0?t[0].toLowerCase()+t.substr(1):""}function _(t,e){t=t||[];for(let i=0;i<e.length;i++)t.indexOf(e[i])===-1&&t.push(e[i]);return t}function S(t,e){return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):!1}function b(t,e){for(;t;){if(S(t,e))return t;t=t.parentElement}return null}function w(t,e){const i=[];for(let n=0;n<t.length;n++)S(t[n],e)&&i.push(t[n]);return i}function I(t,e){const i=[];for(let n=0;n<t.length;n++)_(i,t[n].querySelectorAll(e));return i}function C(t){t=t||{};for(let e=1;e<arguments.length;e++){const i=arguments[e];if(i)for(let n in i)i.hasOwnProperty(n)&&(typeof i[n]=="object"&&i[n]!==null?i[n]instanceof Array?t[n]=i[n].slice(0):t[n]=C(t[n],i[n]):t[n]=i[n])}return t}const Q={enable:function(t,e){const i=this.getFields(t);return this._helper.disabled(i,"unset",e),this},disable:function(t,e){const i=this.getFields(t);return this._helper.disabled(i,"set",e),this},showOption:function(t,e){const i=this.getFields(t);return this._helper.optionVisible(i,"set",e),this},hideOption:function(t,e){const i=this.getFields(t);return this._helper.optionVisible(i,"unset",e),this},show:function(t,e){const i=this.get(t);return this._helper.visibleWrap(i,"set",e),this},hide:function(t,e){const i=this.get(t);return this._helper.visibleWrap(i,"unset",e),this},toggle:function(t,e){const i=this.get(t);return this._helper.visibleWrap(i,"toggle",e),this},showElement:function(t,e){const i=this.get(t);return this._helper.visible(i,"set",e),this},hideElement:function(t,e){const i=this.get(t);return this._helper.visible(i,"unset",e),this},toggleElement:function(t,e){const i=this.get(t);return this._helper.visible(i,"toggle",e),this},fadeIn:function(t,e){const i=this.get(t);return this._helper.fadeWrap(i,"set",e),this},fadeOut:function(t,e){const i=this.get(t);return this._helper.fadeWrap(i,"unset",e),this},slideDown:function(t,e){const i=this.get(t);return this._helper.slideWrap(i,"set",e),this},slideUp:function(t,e){const i=this.get(t);return this._helper.slideWrap(i,"unset",e),this},class:function(t,e,i,n){const s=this.get(t);return this._helper.classWrap(s,e,i,n),this},addClass:function(t,e,i){return this.class(t,"set",e,i)},removeClass:function(t,e,i){return this.class(t,"unset",e,i)},toggleClass:function(t,e,i){return this.class(t,"toggle",e,i)},collapse:function(t,e,i){const n=this.get(t);return this._helper.collapse(n,e,i),this},showCollapse:function(t,e){return this.collapse(t,"set",e)},hideCollapse:function(t,e){return this.collapse(t,"unset",e)},toggleCollapse:function(t,e){return this.collapse(t,"toggle",e)},required:function(t,e,i){const n=this.getFields(t);return this._helper.required(n,e,i),this},setRequired:function(t,e){return this.required(t,"set",e)},unsetRequired:function(t,e){return this.required(t,"unset",e)},toggleRequired:function(t,e){return this.required(t,"toggle",e)},readonly:function(t,e,i){const n=this.getFields(t);return this._helper.readonly(n,e,i),this},setReadonly:function(t,e){return this.readonly(t,"set",e)},unsetReadonly:function(t,e){return this.readonly(t,"unset",e)},toggleReadonly:function(t,e){return this.readonly(t,"toggle",e)},checked:function(t,e,i){const n=this.getFields(t);return this._helper.checked(n,e,i),this},setChecked:function(t,e){return this.checked(t,"set",e)},unsetChecked:function(t,e){return this.checked(t,"unset",e)},toggleChecked:function(t,e){return this.checked(t,"toggle",e)},val:function(t,e,i){const n=this.getFields(t);return e!==void 0?(this._helper.setFieldValue(n,e,i),this):this._helper.fetchFieldValue(n)}},O={fieldTags:["INPUT","SELECT","TEXTAREA","OPTION"],negatives:{prefixes:{add:"remove",show:"hide",en:"dis",un:"",dis:"",re:""},postfixes:{in:"out",up:"down"}},classNames:{requiredIndicator:"required",optionalIndicator:"",wrap:"form-group",label:"control-label",collapseTarget:"collapse",collapseShow:"show"},content:{requiredIndicator:"*",optionalIndicator:"(optional)"},placement:{requiredIndicator:"after",optionalIndicator:"after"},normalizeFields:function(t){if(t.tagName)return[t];const e=[];for(let i=0;i<t.length;i++)e.push(t[i]);return e},applyToElements:function(){const t=d(arguments),e=this.normalizeFields(t.shift()),i=t.shift(),n=t.pop(),s=t.pop();for(let r=0;r<e.length;r++){const o=e[r],l=t.slice(0);l.unshift(o);const u=s.apply(this,l);let c=!1;switch(i){case"set":c=!0;break;case"unset":c=!1;break;case"toggle":c=!u;break}if(u!==c){const p=t.slice(0);p.unshift(c),p.unshift(o),n.apply(this,p)}}},triggerFieldUpdate:function(t){t=this.normalizeFields(t);for(let e=0;e<t.length;e++)t[e].dispatchEvent(new CustomEvent("input",{bubbles:!0,detail:{automatic:!0}})),t[e].dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{automatic:!0}}))},getUniqueFieldId:function(t,e,i){return i[e]||t+"-"+e},fetchFieldValue:function(t){t=this.normalizeFields(t);let e=null;for(let i=0;i<t.length;i++){const n=t[i];if(n.type==="radio"){if(e=0,n.checked)return n.value}else return n.type==="checkbox"?n.checked?n.value:0:n.value}return e},fetchFieldLabelElement:function(t){const e=[];t=this.normalizeFields(t);for(let i=0;i<t.length;i++){const n=t[i],s=this.fetchFieldWrapper(n).shift();let r=s.querySelector('label[for="'+n.id+'"]');r||(r=b(n,"label")),r||(r=s.querySelector("."+this.classNames.label)),r||(r=s.querySelector("label")),r&&e.push(r)}return e},getIndicator:function(t,e,i,n){if(!e)return[];const s="."+e.split(" ").join("."),r=' <span class="'+e+'">'+i+"</span>",o=this.fetchFieldWrapper(t),l=[];for(let u=0;u<o.length;u++){const c=o[u];let p=c.querySelector(s);if(!p){const g=this.fetchFieldLabelElement(c).shift();g?n==="inside"?g.innerHTML=g.innerHTML+r:g.outerHTML=g.outerHTML+r:c.innerHTML=c.innerHTML+r,p=c.querySelector(s),this.visible(p,"unset")}l.push(p)}return l},getRequiredIndicator:function(t){return this.getIndicator(t,this.classNames.requiredIndicator,this.content.requiredIndicator,this.placement.requiredIndicator)},getOptionalIndicator:function(t){return this.getIndicator(t,this.classNames.optionalIndicator,this.content.optionalIndicator,this.placement.optionalIndicator)},fetchFieldLabel:function(t){let e=this.fetchFieldLabelElement(t).shift();e||(e=this.fetchFieldWrapper(t).shift()),e=e.cloneNode(!0);const i=(n,s)=>{if(!s)return;const r=n.querySelectorAll("."+s);for(let o=0;o<r.length;o++)r[o].remove()};return i(e,this.classNames.requiredIndicator),i(e,this.classNames.optionalIndicator),e.innerText},fetchFieldId:function(t){const e=this.normalizeFields(t).shift();if(e){const i=b(e,"form").id;if(!e.id){const n=b(e,"form,[id]");return!n||n.tagName==="FORM"?"":n.id.substr(i.length+1)}return e.id.substr(i.length+1)}return null},fetchFieldWrapper:function(t){const e=[];t=this.normalizeFields(t);for(let i=0;i<t.length;i++){const n=b(t[i],"."+this.classNames.wrap+",form");e.push(n&&n.tagName!=="FORM"?n:t[i])}return e},setFieldValue:function(t,e,i){t=this.normalizeFields(t);for(let n=0;n<t.length;n++){const s=t[n];s.type==="radio"||s.type==="checkbox"?typeof e=="number"||typeof e=="string"?s.value.toString()===e.toString()&&this.checked(s,"set",i):this.checked(s,e?"set":"unset",i):s.value!==e&&(s.value=e,this.triggerFieldUpdate(s))}},checked:function(t,e,i){this.applyToElements(t,e,i,n=>(n.type==="checkbox"||n.type==="radio")&&n.checked,(n,s,r)=>{(n.type==="checkbox"||n.type==="radio")&&(n.checked=s,this.triggerFieldUpdate(n))})},required:function(t,e,i){this.applyToElements(t,e,i,n=>n.required,(n,s,r)=>{const o=this.getRequiredIndicator(n),l=this.getOptionalIndicator(n);n.required=s,this.fade(o,s?"set":"unset",r),this.fade(l,s?"unset":"set",r)})},class:function(t,e,i,n){this.applyToElements(t,e,i,n,(s,r)=>s.classList.contains(r),(s,r,o,l)=>{r?s.classList.add(o):s.classList.remove(o)})},classWrap:function(t,e,i,n){this.class(this.fetchFieldWrapper(t),e,i,n)},collapse:function(t,e,i){const n=I(t,"."+this.classNames.collapseTarget);this.slide(n,e,i),this.classNames.collapseShow&&this.class(n,e,this.classNames.collapseShow,i)},fade:function(t,e,i){this.visible(t,e,i)},fadeWrap:function(t,e,i){this.fade(this.fetchFieldWrapper(t),e,i)},slide:function(t,e,i){this.visible(t,e,i)},slideWrap:function(t,e,i){this.slide(this.fetchFieldWrapper(t),e,i)},readonly:function(t,e,i){this.applyToElements(t,e,i,n=>n.readOnly,(n,s,r)=>{n.readOnly=s})},disabled:function(t,e,i){this.applyToElements(t,e,i,n=>n.disabled,(n,s,r)=>{n.disabled=s})},visible:function(t,e,i){this.applyToElements(t,e,i,n=>n.style.display!=="none",(n,s,r)=>{n.style.display=s?"":"none"})},visibleWrap:function(t,e,i){this.visible(this.fetchFieldWrapper(t),e,i)},optionVisible:function(t,e,i){this.applyToElements(t,e,i,n=>!n.hidden||!n.disabled,(n,s,r)=>{n.hidden=!s,n.disabled=!s}),this.sanitizeSelectOption(t)},sanitizeSelectOption:function(t){const e=n=>!n.hidden||!n.disabled;this.normalizeFields(t).forEach(n=>{if(!e(n)){const s=n.closest("select");if(s!==null&&s.value===n.value){const r=s.querySelectorAll("option");for(let o=0;o<r.length;o++)if(e(r[o])){s.value=r[o].value;break}}}})}},T={required:function(t,e,i){return e.required},"not-required":function(t,e,i){return!e.required},readonly:function(t,e,i){return e.readOnly},"not-readonly":function(t,e,i){return!e.readOnly},empty:function(t,e,i){return!i},false:function(t,e,i){return!i},"not-empty":function(t,e,i){return!!i},true:function(t,e,i){return!!i},valid:function(t,e,i){return e.tagName==="OPTION"&&(e=e.closest("SELECT")),e.checkValidity()},"not-valid":function(t,e,i){return e.tagName==="OPTION"&&(e=e.closest("SELECT")),!e.checkValidity()},"value:.+":function(t,e,i){return i===t.substr(6)},"not:.+":function(t,e,i){return i!==t.substr(4)},"file-extension:.+":function(t,e,i){const n=i.indexOf(".")!==-1?i.split(".").pop().toLowerCase():"",s=t.substr(15).toLowerCase().split(",");return n&&s.indexOf(n)!==-1},"not-file-extension:.+":function(t,e,i){const n=i.indexOf(".")!==-1?i.split(".").pop().toLowerCase():"",s=t.substr(19).toLowerCase().split(",");return!n||s.indexOf(n)===-1}},L={required:!1,"not-required":!0,readonly:!1,"not-readonly":!0,empty:!0,false:!0,"not-empty":!1,true:!1,valid:!1,"not-valid":!0,"value:.+":!1,"not:.+":!0,"file-extension:.+":!1,"not-file-extension:.+":!0},x={formScripts:{},formApis:{},actions:Q,actionNegatives:{},helper:O,evaluations:T,evaluationDefaults:L};function m(t,e,i){this._form=t,this._query=e,this._isRoot=i}m.prototype.trigger=function(){return this._query.trigger(),this};m.prototype.pause=function(){return this._query.pause(),this};m.prototype.resume=function(){return this._query.resume(),this};m.prototype.if=function(t,e){let i=!1;switch(typeof e>"u"&&(e="<form>"),typeof t){case"function":i={eval:e?()=>t(e,this._form.val(e)):t};break;case"object":t&&t.eval&&(i=t);break;case"string":case"number":case"boolean":i={eval:()=>this._form.eval(e,t)};break}return i&&this._query.addCondition(i),e&&this.on(e),this._query.getJunctionQuery()};m.prototype.on=function(t){let e=t;if(t){const i=t.split(",");for(let n=0;n<i.length;n++)i[n]=i[n].trim().split(":").shift();e=i.join(",")}return this._form.on("input",e,()=>{this._query.trigger()}),this._form.on("change",e,()=>{this._query.trigger()}),this._query.getJunctionQuery()};m.prototype.openBracket=function(){const t=new f(this._form,this._query);return this.if(t),t.init.apply(t,d(arguments))};function h(t,e,i){this._form=t,this._query=e,this._isRoot=i;function n(r){return function(){const o=d(arguments),l=e.negateDirectAction()?"else":"then";return o.unshift(r),this[l].apply(this,o)}}const s=this._form.getActions();for(let r=0;r<s.length;r++){const o=s[r];this[o]=n(o)}}h.prototype.eval=function(){return this._query.eval()};h.prototype.trigger=function(){return this._query.trigger(),this};h.prototype.pause=function(){return this._query.pause(),this};h.prototype.resume=function(){return this._query.resume(),this};h.prototype.and=function(){this._query.and();let t=this._query.getConditionQuery();return arguments.length>0&&(t=t.if.apply(t,d(arguments))),t};h.prototype.or=function(){this._query.or();let t=this._query.getConditionQuery();return arguments.length>0&&(t=t.if.apply(t,d(arguments))),t};h.prototype.andOpenBracket=function(){const t=this.and();return t.openBracket.apply(t,d(arguments))};h.prototype.orOpenBracket=function(){const t=this.or();return t.openBracket.apply(t,d(arguments))};h.prototype.closeBracket=function(){let t=this;return this._isRoot||(t=this._query.getParentQuery().getJunctionQuery()),arguments.length>0&&(t=t.then.apply(t,d(arguments))),t};h.prototype.call=function(t){return this._isRoot?(this._query.addCallback(t),this):this.closeBracket().call(t)};h.prototype.then=function(){if(this._query.negateDirectAction(!1),arguments.length>0){const t=d(arguments),e=t.shift();return this.call((i,n)=>{this._query.applyActions(e,t,!i,n)})}return this};h.prototype.else=function(){if(this._query.negateDirectAction(!0),arguments.length>0){const t=d(arguments),e=t.shift();return this.call((i,n)=>{this._query.applyActions(e,t,i,n)})}return this};h.prototype.onlyThen=function(){const t=d(arguments),e=t.shift();return this.call((i,n)=>{i&&this._query.applyActions(e,t,!1,n)})};h.prototype.onlyElse=function(){const t=d(arguments),e=t.shift();return this.call((i,n)=>{i||this._query.applyActions(e,t,!1,n)})};h.prototype.once=function(){const t=d(arguments),e=t.shift();let i=!1;return this.call((n,s)=>{i||(n&&(i=!0),this._query.applyActions(e,t,!n,s))})};function f(t,e){this._form=t,this._parentQuery=e,this._cbs=[],this._conditions=[[]],this._lastState=void 0,this._paused=!1,this._negateDirectAction=!1,this._conditionQuery=new m(t,this,!e),this._junctionQuery=new h(t,this,!e)}f.prototype.applyActions=function(t,e,i,n){typeof t=="function"&&(t=[t]),typeof t!="object"&&(t=t.toString().split(","));for(let s=0;s<t.length;s++){let r=t[s];if(i&&(r=this._form.getActionNegative(r)),!r)continue;const o=e.slice(0);n&&o.push(n),typeof r=="function"?r(n):this._form.actionExists(r)&&this._form[r].apply(this._form,o)}};f.prototype.trigger=function(){if(this._parentQuery)return this._parentQuery.trigger();if(this._paused)return;const t=this.eval();if(this._lastState!==t){const e=this._lastState===void 0;for(let i=0;i<this._cbs.length;i++)this._cbs[i](t,e);this._lastState=t}};f.prototype.addCallback=function(t){if(this._parentQuery)return this._parentQuery.addCallback(t);this._cbs.push(t),this._lastState===void 0?this.trigger():t(this.eval(),!0)};f.prototype.pause=function(){if(this._parentQuery)return this._parentQuery.pause();this._paused=!0};f.prototype.resume=function(){if(this._parentQuery)return this._parentQuery.resume();this._paused=!1};f.prototype.eval=function(){for(let t=0;t<this._conditions.length;t++){let e=!0;for(let i=0;i<this._conditions[t].length;i++)this._conditions[t][i].eval()||(e=!1);if(e)return!0}return!1};f.prototype.negateDirectAction=function(t){return this._parentQuery?this._parentQuery.negateDirectAction(t):(t!==void 0&&(this._negateDirectAction=t),this._negateDirectAction)};f.prototype.or=function(){this._conditions.push([])};f.prototype.and=function(){};f.prototype.addCondition=function(t){this._conditions[this._conditions.length-1].push(t),t.call&&t.call(this.trigger.bind(this))};f.prototype.getJunctionQuery=function(){return this._junctionQuery};f.prototype.getConditionQuery=function(){return this._conditionQuery};f.prototype.getParentQuery=function(){return this._parentQuery};f.prototype.init=function(){let t=this.getConditionQuery();return arguments.length>0&&(t=t.if.apply(t,d(arguments))),t};function a(t,e){this._helper=e.helper,this._form=t,this._id=t.id,this._fieldIdAliases={},this._actions=[],this._actionNegatives={},this._evaluations={},this._evaluationDefaults={},this._ifQueries=[],this._hasChanged=!1;let i;for(i in e.actions)this.registerAction(i,e.actions[i]);for(i in e.actionNegatives)this.registerActionNegative(i,e.actionNegatives[i]);for(i in e.evaluations)this.registerEvaluation(i,e.evaluations[i],e.evaluationDefaults[i]);this.setAlias(this.id(),"<form>"),this.on("input change","",(n,s,r)=>{r||(this._hasChanged=!0)})}a.prototype.id=function(){return this._id};a.prototype.hasChanged=function(){return this._hasChanged};a.prototype.setAlias=function(t,e){this._fieldIdAliases[e]=t};a.prototype.getUniqueFieldId=function(t){return this._helper.getUniqueFieldId(this.id(),t,this._fieldIdAliases)};a.prototype.getFieldAlias=function(t){for(let e in this._fieldIdAliases)if(this._fieldIdAliases[e]===t)return e;return""};a.prototype.registerAction=function(t,e){this[t]=e,this._actions.push(t)};a.prototype.registerActionNegative=function(t,e){this._actionNegatives[t]=e,this._actionNegatives[e]=t};a.prototype.getActions=function(){return this._actions};a.prototype.actionExists=function(t){return this._actions.indexOf(t)>=0};a.prototype.getActionNegative=function(t){if(typeof t=="function")return!1;if(this._actionNegatives[t])return this._actionNegatives[t];const e=(n,s,r)=>{const o=(u,c)=>{if(s(t,u)){const p=r(t,u,c);for(let g=0;g<p.length;g++){let y=p[g];if(this.actionExists(y))return y}}return!1};let l;for(let u in n){const c=n[u];if(l=o(u,c)||o(c,u),l)break}return l};let i=e(this._helper.negatives.prefixes,(n,s)=>n.substr(0,s.length)===s,(n,s,r)=>[r+v(n.substr(s.length)),r+E(n.substr(s.length))]);return i||(i=e(this._helper.negatives.postfixes,(n,s)=>v(n.substr(-s.length))===v(s),(n,s,r)=>[n.substr(0,n.length-s.length)+v(r),n.substr(0,n.length-s.length)+E(r)])),i&&this.registerActionNegative(t,i),i};a.prototype.registerEvaluation=function(t,e,i){this._evaluations[t]=e,this._evaluationDefaults[t]=!!i};a.prototype.get=function(t,e,i){e=e||this._form;let n,s,r;const o=[];if(!t)_(o,e.querySelectorAll(this._helper.fieldTags.join(",")));else{const l=t.split(",");for(n=0;n<l.length;n++){let u=l[n].trim(),c=[];const p=u.indexOf(":");p>=0&&(c=u.substr(p+1).split(":"),u=u.substr(0,p));const g=this.getUniqueFieldId(u),y=_(w([e],'[id="'+g+'"]'),e.querySelectorAll('[id="'+g+'"]'));if(!i&&y.length,c.length===0)_(o,y);else for(s=0;s<c.length;s++){let q=!1;const F='[value="'+c[s]+'"]',A=w(y,F);for(A.length>0&&(q=!0),_(o,A),r=0;r<y.length;r++){const k=y[r].querySelectorAll(F);k.length>0&&(q=!0),_(o,k)}!i&&y.length>0}}}return o};a.prototype.getFields=function(t,e){e=e||this._form;const i=this.get(t,e),n=[];for(let s=0;s<i.length;s++){const r=i[s];this._helper.fieldTags.indexOf(r.tagName)!==-1?_(n,[r]):_(n,this.get("",r))}return n};a.prototype.getFieldWrapper=function(t,e){const i=this.getFields(t,e);return this._helper.fetchFieldWrapper(i)};a.prototype.getFieldLabel=function(t,e){const i=this.getFields(t,e);return this._helper.fetchFieldLabel(i)};a.prototype.exists=function(t){return this.get(t,null,!0).length>0};a.prototype.on=function(t,e,i){typeof e=="function"&&(i=e,e=""),typeof t=="string"&&(t=t.split(" "));const n=this.getFields(e);for(let s=0;s<n.length;s++)for(let r=0;r<t.length;r++)n[s].addEventListener(t[r],o=>{const l=o.target,u=!!(o.detail&&o.detail.automatic);i.apply(l,[this._helper.fetchFieldId(l),this._helper.fetchFieldValue(l),u])});return this};a.prototype.if=function(){const t=new f(this);return this._ifQueries.push(t),t.init.apply(t,d(arguments))};a.prototype.triggerAllQueries=function(){for(let t=0;t<this._ifQueries.length;t++)this._ifQueries[t].trigger()};a.prototype.eval=function(t,e){const i=this.getFields(t);let n=function(o,l,u){return o===u},s=!1;for(let o in this._evaluations)if(e.toString().match(new RegExp("^"+o+"$"))){n=this._evaluations[o],s=!!this._evaluationDefaults[o];break}if(i.length===0)return s;let r=!0;for(let o=0;o<i.length;o++){const l=this._helper.fetchFieldValue(i[o]);r=r&&!!n(e,i[o],l)}return r};window.formLogic=C({},x,window.formLogic||{});document.addEventListener("DOMContentLoaded",()=>{const t=window.formLogic;for(let e in t.formScripts){const i=document.getElementById(e),n=new a(i,t);t.formApis[n.id()]=n;const s=t.formScripts[e];s(n),document.dispatchEvent(new CustomEvent("form-logic-form-ready",{detail:{id:e}})),document.dispatchEvent(new CustomEvent("dependency-script-form-ready",{detail:{id:e}}))}document.dispatchEvent(new CustomEvent("form-logic-script-ready")),document.dispatchEvent(new CustomEvent("dependency-script-ready"))});
